@page "/{quicklink?}"
@inherits FluxorComponent
@using DockerGen.Container
@using DockerGen.Features.Container.Store
@inject IDispatcher Dispatcher
<CascadingValue Value="this">
    <aside class="editorcontainer__left">
        <ComponentList OnStartDrag="OnDragStart"></ComponentList>
    </aside>
    <article class="editorcontainer__middle">
        <BuildStageOverview></BuildStageOverview>
        <div class="editorcontainer__stages">
            <ImageContainer OnStartDrag="OnDragStart"></ImageContainer>
        </div>
    </article>
    <div class="editorcontainer__right">
        <Preview></Preview>
    </div>
</CascadingValue>

@code {
    [Parameter]
    public string QuickLink { get; set; }
    public IInstruction CurrentInstruction { get; set; }
    public bool IsDragging { get; set; }
    protected override void OnInitialized()
    {
        base.OnInitialized();
        if (!string.IsNullOrEmpty(QuickLink))
        {
            Dispatcher.Dispatch(new ContainerLoadQuickLinkAction(QuickLink));
        }
    }

    private void OnDragStart(IInstruction instruction)
    {
        if (instruction == null)
        {
            IsDragging = false;
            CurrentInstruction = null;
        }
        else
        {
            IsDragging = true;
            CurrentInstruction = instruction;
        }
        StateHasChanged();
    }
}